# Return_to_Libc

## 知识点

1. **[question]**P93

2. **[question]**P96

3. **函数的序言**：函数开头处的代码，用于为函数准备栈和指针，

   ```assembly
   pushl %ebp			// 保存ebp值（它目前指向调用者的栈帧）
   movl %esp, %ebp		// 让ebp指向被调用者的栈帧
   subl $N, %esp		// 为局部变量预留空间
   ```

   **函数的后记**：函数末尾处的代码，用于恢复栈和寄存器到函数调用以前的状态。

   ```assembly
   movl %ebp, %esp		// 释放为局部变量开辟的栈空间 
   popl %ebp			// 让ebp指回调用者函数的栈帧
   ret					// 返回
   ```

4. **EBP**是当前函数的存取指针，即存储或者读取数时的指针基地址只是存取某时刻的栈顶指针,以方便对栈的操作,如获取函数参数、局部变量等；

   **ESP**就是当前函数的栈顶指针，一直指向栈顶的指针。

   **EIP**：寄存器里存储的是CPU下次要执行的指令的地址。也就是调用完fun函数后，让CPU知道应该执行main函数中的printf（"函数调用结束"）语句了。

5. **return_to_lib**中，函数结束时的返回地址不能随意，很可能导致程序崩溃，一个较好的办法是使用exit()函数。

6. **返回导向编程**（Return-Oriented Programming，ROP）：不一定要返回到一个已有函数，巧妙地将内存中的一些小的指令序列串起来，这些指令序列其实并不放在一起，但它们的最后一个指令都是return。

   

## 习题

## 实验