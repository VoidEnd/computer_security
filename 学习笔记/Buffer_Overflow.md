# Buffer_Overflow

## 知识点

1. **[question]**返回地址和前栈指针，帧指针寄存器

2. **地址空间随机化**（address space layout randomization， ASLR），用`sudo sysctl -w kernel.randomize_va_space=0`关闭。可攻破。

3. **argc** ：是 argument count的缩写，表示argv这个二级指针指向的内存区域中保存的由stub写入的有效命令行参数的个数.

   **argv** ：是 argument vector的缩写，表示传入main函数的参数序列或指针，并且第一个参数argv[0]一定是程序的名称，并且包含了程序所在的完整路径，所以确切的说需要输入的main函数的参数个数是argc-1个。

4. **不可执行栈**（non-executable stack）：默认情况下，一个程序的栈是不可执行的，因此在栈中注入的恶意代码也是无法执行的。可由return-to-libc攻破。可用`-z execstack`关闭。

5. **StackGuard**：能够抵御基于栈的缓冲区溢出攻击，主要思想是在代码中添加一些特殊数据和检测机制，从而可以检测到缓冲区溢出的发生，已被gcc采纳。可用`-fno-stack-protector`关闭。

6. 在引入一些防御措施之前，大多数系统会把栈（每个进程有一个栈）放在固定的起始位置。

7. **nop**：这个指令在汇编中的作用是空指令，意味着什么都不做的意思，一般用来控制CPU的时间周期，达到时钟延时的效果。可以通过填充nop指令，为恶意代码创建大量入口点。P70

8. **touch**：用于修改文件或者目录的时间属性，包括存取时间和更改时间。若文件不存在，系统会建立一个新的文件。

9. **$**的常见用法：

   - 显示脚本参数（$0、$?、$\*、$@、$#、$$、$!）（本质上属于变量替换）
   - 获取变量与环境变量的值
   - 组合用法，如shell中$(( ))、$( )、${ }，功能各不相同。

10. **[question]**P72

11. **#!**：是特殊的表示符，其后面跟的是解释此脚本的shell路径。

12. **gdb调试时**会向栈里压入一些额外的数据，这将导致调试时的栈帧可能比直接运行程序时的栈帧更深一些。**恶意输入文件**中至入口之前不应出现“\0”，会导致复制提前停止。

13. **shellcode**：因为加载器问题和代码中的0,，导致不能使用由C语言程序生成的二进制代码作为恶意代码，需要直接用**汇编语言**来编写。

14. **汇编语言**：

15. **防御措施概述：**

    - 更安全的函数
    - 更安全的动态链接库，libsafe函数库，libmib函数库
    - 程序静态分析，目的是在开发早期警告开发者程序中的潜在不安全代码
    - 编程语言，由编程语言本身进行缓冲区溢出的检测，如Java、Python
    - 编译器：可以控制栈的布局，同时也可以在二进制程序中插入验证栈完整性的指令。Stackshield的方法是将返回地址备份到一个安全的地方，在函数返回之前进行返回地址对比；StackGuard的方法是在返回地址与缓冲区之间设置一个哨兵（canary），当返回地址被修改时哨兵值同样也会被修改，而哨兵值是一个随机数，他的原始备份存放在一个栈以外不会受到缓冲区溢出影响的地方，在函数返回之前进行哨兵值对比。
    - 操作系统，需要把程序加载进来并设置好运行环境，在此阶段操作系统可以指定进程的内存布局。地址空间随机化（address space layout randomization， ASLR），增加攻击难度。
    - 硬件体系结构，现代CPU支持一种叫NX bit的特性，即No-Execute，“不可执行”，是一种将代码和数据分离的技术，可以将某些内存区域设置为不可执行，可以通过这个特性将栈设置为不可执行。

16. **ELF**(Executable and Linkable Format)即可执行连接文件格式，

17. **熵**：衡量地址空间随机程度。在32位linux系统中，栈的熵为19bit，堆的熵为13bit，很容易被暴力破解，而64位系统则会困难很多。

    熵不够大时，攻击者可以进行暴力破解攻击，为抵御暴力破解攻击，可以在程序崩溃次数达到一定数量后，在一段时间内禁止该程序再次被执行，如grsecurity。

18. **IDE**：集成开发环境（IDE，Integrated Development Environment ）是用于提供程序开发环境的应用程序，一般包括代码编辑器、编译器、调试器和图形用户界面等工具。集成了代码编写功能、分析功能、编译功能、调试功能等一体化的开发软件服务套。

19. **GS寄存器**：指向的内存段是一个特殊的区域，不同于栈、堆、BSS段、数据段和代码段，重要的是，GS段与栈物理隔离，所以不会受堆栈的缓冲区溢出影响。

20. 

    

    

## 习题

## 实验

